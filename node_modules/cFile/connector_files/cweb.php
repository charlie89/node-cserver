<?PHP
//error_reporting(0);
$action = $_GET['action'];
$path = './'.$_GET['path'];
header("Content-Type: application/json");

if ($action=='browse'){
    browse($action, $path);
}
else 
{
    echo json_encode($e->error = "Not implemented yet.");
}

function browse($action, $path) {
    $result->header->path = substr($path, 2) ? substr($path, 2) : '';
    $result->content = array();
    $files = scandir($path);
    $first = true;
    foreach($files as $file) {
        if ($first) {
            $first = false;
        } else {
            $fp = $path.$file;
            $e->mimeType = mime_content_type($fp);
            $e->isFile = !$e->isDirectory = ($e->mimeType == 'directory') ? true : false;
            $e->name = pathinfo($file, PATHINFO_FILENAME);
            if ($e->name == '.') $e->name = '..';
            $e->path = substr($fp, 2).($e->isDirectory ? '/' : '');
            $e->filename = $file;
            $e->image = "image/mimetypes/".str_replace("/", "-", $e->mimeType).".png";
            $e->size = 0;
            $e->timeAccessed = 0;
            $e->timeCreated = 0;
            $e->timeModified = 0;
            array_push($result->content, $e);
            unset($e);
        }
    }
    echo json_encode($result);
} 
?>